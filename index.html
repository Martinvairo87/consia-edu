<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CONSIA EDU CORE</title>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:radial-gradient(circle at top,#0b1230,#030611);
color:white;
text-align:center;
}

h1{
margin-top:25px;
font-size:32px;
}

.hidden{display:none;}

.container{padding:20px;}

input{
padding:12px;
margin:8px;
border-radius:10px;
border:none;
width:250px;
}

button{
padding:12px 20px;
margin:6px;
border-radius:10px;
border:none;
cursor:pointer;
background:linear-gradient(135deg,#355cff,#6a8dff);
color:white;
}

button:hover{
transform:scale(1.05);
}

.avatar{
width:180px;
height:180px;
border-radius:50%;
object-fit:cover;
box-shadow:0 0 30px #4d7cff;
margin-top:20px;
transition:0.3s;
}

.avatar.talking{
transform:scale(1.05);
box-shadow:0 0 60px #8aa7ff;
}

.avatar-options img{
width:60px;
height:60px;
border-radius:50%;
margin:5px;
cursor:pointer;
border:2px solid transparent;
}

.avatar-options img.active{
border:2px solid #5b7cff;
}

.response{
margin-top:15px;
min-height:40px;
}

.progress{
margin-top:10px;
opacity:0.8;
}

</style>
</head>

<body>

<h1>CONSIA EDU CORE</h1>

<div id="authSection" class="container">
<h3>Crear Perfil</h3>
<input type="text" id="nameInput" placeholder="Tu nombre">
<br>
<button onclick="register()">Entrar</button>
</div>

<div id="appSection" class="hidden container">

<h3 id="welcome"></h3>

<img id="avatar" class="avatar" src="https://i.imgur.com/7k12EPD.png">

<div class="avatar-options">
<img src="https://i.imgur.com/7k12EPD.png" onclick="changeAvatar(this)" class="active">
<img src="https://i.imgur.com/eM1bW2S.png" onclick="changeAvatar(this)">
<img src="https://i.imgur.com/tX6K0xF.png" onclick="changeAvatar(this)">
<img src="https://i.imgur.com/6VBx3io.png" onclick="changeAvatar(this)">
</div>

<br>

<button onclick="startListening()">üé§ Hablar</button>
<button onclick="processText()">‚å®Ô∏è Enviar</button>
<button onclick="logout()">Salir</button>

<br>

<input type="text" id="textInput" placeholder="Escribe aqu√≠..." onkeydown="if(event.key==='Enter'){processText();}">

<div class="response" id="responseText"></div>

<div class="progress" id="progressInfo"></div>

</div>

<script>

const API_URL = "https://api.consia.world/ask";
let currentUser = null;
let lastResponse = "";
let progress = 0;

function register(){
const name = document.getElementById("nameInput").value;
if(!name) return alert("Ingresa tu nombre");
currentUser = {
name: name,
avatar: document.getElementById("avatar")?.src || "https://i.imgur.com/7k12EPD.png",
progress: 0
};
localStorage.setItem("consiaUser", JSON.stringify(currentUser));
loadUser();
}

function loadUser(){
const user = JSON.parse(localStorage.getItem("consiaUser"));
if(!user) return;
currentUser = user;
document.getElementById("authSection").classList.add("hidden");
document.getElementById("appSection").classList.remove("hidden");
document.getElementById("welcome").innerText = "Hola " + user.name + " üëã";
document.getElementById("avatar").src = user.avatar;
progress = user.progress || 0;
updateProgress();
}

function logout(){
localStorage.removeItem("consiaUser");
location.reload();
}

function changeAvatar(element){
document.querySelectorAll('.avatar-options img').forEach(a=>a.classList.remove('active'));
element.classList.add('active');
document.getElementById("avatar").src = element.src;
currentUser.avatar = element.src;
localStorage.setItem("consiaUser", JSON.stringify(currentUser));
}

async function sendToConsia(message){
try{
const res = await fetch(API_URL,{
method:"POST",
headers:{ "Content-Type":"application/json" },
body: JSON.stringify({
message: message,
mode: "kids",
user: currentUser.name
})
});
const data = await res.json();
return data.reply || "Sigamos aprendiendo üåü";
}catch(e){
return "Modo demo activo.";
}
}

function startListening(){
const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.lang = "es-ES";
recognition.start();
recognition.onresult = async function(event){
const speech = event.results[0][0].transcript;
processInput(speech);
};
}

function processText(){
const text = document.getElementById("textInput").value;
processInput(text);
}

async function processInput(input){
document.getElementById("responseText").innerText = "Pensando...";
const aiReply = await sendToConsia(input);
lastResponse = aiReply;
document.getElementById("responseText").innerText = aiReply;
progress += 5;
currentUser.progress = progress;
localStorage.setItem("consiaUser", JSON.stringify(currentUser));
updateProgress();
speakResponse();
}

function speakResponse(){
const avatar = document.getElementById("avatar");
avatar.classList.add("talking");
const utterance = new SpeechSynthesisUtterance(lastResponse);
speechSynthesis.speak(utterance);
utterance.onend = ()=>{
avatar.classList.remove("talking");
};
}

function updateProgress(){
document.getElementById("progressInfo").innerText = "Progreso: " + progress + "%";
}

window.onload = loadUser;

</script>

</body>
</html>
