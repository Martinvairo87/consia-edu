<script>

const API_URL = "https://api.consia.world/ask";

let lastResponse = "";

async function sendToConsia(message){
  const res = await fetch(API_URL, {
    method:"POST",
    headers:{
      "Content-Type":"application/json"
    },
    body: JSON.stringify({
      message: message,
      mode: "kids",
      language: "auto"
    })
  });

  const data = await res.json();
  return data.reply || "Estoy aprendiendo contigo ðŸ’«";
}

function startListening(){
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "auto";
  recognition.start();

  recognition.onresult = async function(event){
    const speech = event.results[0][0].transcript;
    processInput(speech);
  };
}

function processText(){
  const text = document.getElementById("textInput").value;
  processInput(text);
}

async function processInput(input){
  document.getElementById("responseText").innerText = "Pensando...";
  
  const aiReply = await sendToConsia(input);
  lastResponse = aiReply;

  document.getElementById("responseText").innerText = aiReply;
  speakResponse();
}

function speakResponse(){
  const utterance = new SpeechSynthesisUtterance(lastResponse);
  utterance.lang = "auto";
  speechSynthesis.speak(utterance);
}

</script>
